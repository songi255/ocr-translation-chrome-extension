(()=>{"use strict";const e=new class{constructor(){this.state="idle",this.crop={}}enterCaptureMode(){if("idle"!==this.state)throw new Error("Only can enter from IDEL state.");this.state="capture",this.crop.devicePixelRatio=window.devicePixelRatio,this.installGuide()}pickFirstPoint(e){this.crop.sx=e.clientX,this.crop.sy=e.clientY}pickSecondPoint(e){this.crop.ex=e.clientX,this.crop.ey=e.clientY}requestCapture(){if(this.crop.ex==this.crop.sx||this.crop.ey==this.crop.sy)throw new Error("capture resion size can't be zero.");chrome.runtime.sendMessage({eventType:"request-screenshot",message:Object.assign({},this.crop)})}endCapture(){"idle"!==this.state&&(this.state="idle",this.unInstallGuide())}installGuide(){document.body.style.cursor="crosshair"}unInstallGuide(){document.body.style.cursor="auto"}registerTrigger(){chrome.runtime.onMessage.addListener((e=>{"start-capture"===e.eventType&&this.enterCaptureMode()}))}installScript(){this.registerTrigger(),window.addEventListener("mousedown",(e=>this.mouseDownListner(e))),window.addEventListener("mousemove",(e=>this.mouseMoveListner(e))),window.addEventListener("mouseup",(e=>this.mouseUpListner(e)))}mouseDownListner(e){"idle"!==this.state&&(e.preventDefault(),e.stopPropagation(),this.pickFirstPoint(e))}mouseMoveListner(e){this.state}mouseUpListner(e){if("idle"!==this.state){e.preventDefault(),e.stopPropagation(),this.pickSecondPoint(e),console.log(this.crop);try{this.requestCapture()}catch(e){console.error(e)}finally{this.endCapture()}}}},t=new class{registerViewer(){chrome.runtime.onMessage.addListener((e=>{if("show-result"===e.eventType){const t=e.message;this.view(t)}}))}view(e){console.log(e)}};e.installScript(),t.registerViewer()})();